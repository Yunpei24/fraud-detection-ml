apiVersion: 1

contactPoints:
  - orgId: 1
    name: email
    receivers:
    - uid: email-receiver
      type: email
      settings:
        addresses: alerts@yourcompany.com
        singleEmail: false

  - orgId: 1
    name: slack
    receivers:
    - uid: slack-receiver
      type: slack
      settings:
        url: https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
        username: Fraud Detection Alert
        icon_emoji: ':warning:'
        title: '{{ template "slack.title" . }}'
        text: '{{ template "slack.text" . }}'

  - orgId: 1
    name: webhook
    receivers:
    - uid: webhook-receiver
      type: webhook
      settings:
        url: http://alertmanager:9093/api/v2/alerts
        httpMethod: POST

policies:
  - orgId: 1
    receiver: email
    group_by:
      - alertname
      - severity
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      - receiver: slack
        matchers:
          - severity=critical
        continue: true
      - receiver: webhook
        matchers:
          - service=api
          - service=data
        continue: true
      - receiver: email
        matchers:
          - severity=warning
        continue: true

templates:
  - orgId: 1
    name: slack.title
    template: |
      {{ if eq .Status "firing" }}:fire: {{ .GroupLabels.alertname }}{{ else }}:white_check_mark: {{ .GroupLabels.alertname }} Resolved{{ end }}

  - orgId: 1
    name: slack.text
    template: |
      {{ range .Alerts }}
      *{{ .Annotations.summary }}*
      {{ .Annotations.description }}

      Labels:
      {{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: {{ .Value }}
      {{ end }}

      {{ if .Annotations.runbook_url }}Runbook: {{ .Annotations.runbook_url }}{{ end }}
      {{ end }}
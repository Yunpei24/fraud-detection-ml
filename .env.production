# ==============================================================================
# FRAUD DETECTION SYSTEM - Production Environment Variables
# ==============================================================================
# Complete configuration file for Docker Compose (local & production)
#
# SETUP INSTRUCTIONS:
# 1. For local: cp .env.production .env
# 2. Update all passwords with secure values for production
# 3. Configure Azure credentials if using cloud storage
# 4. Generate new keys for AIRFLOW_FERNET_KEY, AIRFLOW_SECRET_KEY, JWT_SECRET_KEY
# 5. NEVER commit .env to version control (it's in .gitignore)
#
# SECURITY: All default passwords MUST be changed in production
# ==============================================================================

# ==============================================================================
# ENVIRONMENT
# ==============================================================================
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# ==============================================================================
# POSTGRESQL DATABASE
# ==============================================================================
POSTGRES_USER=fraud_user_prod
POSTGRES_PASSWORD=CHANGE_THIS_IN_PRODUCTION        
POSTGRES_DB=fraud_detection
POSTGRES_PORT=5432
POSTGRES_HOST=your-postgres-server.postgres.database.azure.com

# Legacy variables (for backward compatibility)
DB_HOST=your-postgres-server.postgres.database.azure.com
DB_PORT=5432
DB_NAME=fraud_detection
DB_USER=fraud_user_prod
DB_PASSWORD=CHANGE_THIS_IN_PRODUCTION
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
DB_SSL_MODE=require

# ==============================================================================
# REDIS CACHE
# ==============================================================================
REDIS_PASSWORD=CHANGE_THIS_IN_PRODUCTION             # ⚠️ CHANGE IN PRODUCTION
REDIS_PORT=6379
REDIS_HOST=your-redis-server.redis.cache.windows.net
REDIS_DB=0
REDIS_SSL=true
REDIS_TTL_SECONDS=3600

# ==============================================================================
# AZURE (Cloud Services - Required for Production)
# ==============================================================================
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=yourstorageaccount;AccountKey=your_key;EndpointSuffix=core.windows.net
AZURE_STORAGE_ACCOUNT_NAME=yourstorageaccount
AZURE_STORAGE_ACCOUNT_KEY=your_key
AZURE_STORAGE_CONTAINER_NAME=fraud-models
AZURE_KEY_VAULT_URL=https://fraud-detection-kv.vault.azure.net/
DOCKERHUB_USERNAME=yoshua24

# Azure Web App Configuration (for API deployment)
AZURE_WEBAPP_NAME=fraud-detection-api
AZURE_RESOURCE_GROUP=fraud-detection-rg
AZURE_LOCATION=eastus

# ==============================================================================
# MLFLOW - PRODUCTION CONFIGURATION
# ==============================================================================
MLFLOW_BACKEND_STORE_URI=postgresql://fraud_user_prod:${DB_PASSWORD}@${DB_HOST}:5432/fraud_detection
MLFLOW_DEFAULT_ARTIFACT_ROOT=wasbs://mlflow@${AZURE_STORAGE_ACCOUNT_NAME}.blob.core.windows.net/artifacts
MLFLOW_TRACKING_URI=https://fraud-detection-mlflow.azurewebsites.net
MLFLOW_EXPERIMENT_NAME=fraud-detection
MLFLOW_MODEL_NAME=fraud-detection-ensemble

# ==============================================================================
# AIRFLOW - PRODUCTION CONFIGURATION
# ==============================================================================
AIRFLOW_ADMIN_USERNAME=admin
AIRFLOW_ADMIN_PASSWORD=CHANGE_THIS_IN_PRODUCTION    
AIRFLOW_ADMIN_EMAIL=admin@frauddetection.com

# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
AIRFLOW_FERNET_KEY=CHANGE_THIS_FERNET_KEY_IN_PRODUCTION   #  GENERATE NEW

# Generate with: openssl rand -hex 32
AIRFLOW_SECRET_KEY=CHANGE_THIS_SECRET_KEY_IN_PRODUCTION   #  GENERATE NEW

AIRFLOW_DATABASE_URL=postgresql://fraud_user_prod:${DB_PASSWORD}@${DB_HOST}:5432/fraud_detection
AIRFLOW_EXECUTOR=CeleryExecutor
AIRFLOW_PARALLELISM=32
AIRFLOW_MAX_ACTIVE_RUNS_PER_DAG=3

# ==============================================================================
# API MODULE CONFIGURATION
# ==============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false
API_VERSION=1.0.0
API_TITLE=Fraud Detection API
API_DESCRIPTION=Real-time fraud detection API with ensemble models

API_FRAUD_THRESHOLD=0.5
API_CONFIDENCE_THRESHOLD=0.7

API_RATE_LIMIT_ENABLED=true
API_RATE_LIMIT_REQUESTS=1000
API_RATE_LIMIT_PERIOD=60

API_CORS_ORIGINS=https://your-frontend-domain.com,https://api.frauddetection.com
API_CORS_ALLOW_CREDENTIALS=true
API_CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
API_CORS_ALLOW_HEADERS=*

API_ENABLE_BATCH_PREDICTION=true
API_ENABLE_SHAP_EXPLANATION=true
API_ENABLE_MODEL_RELOAD=true
API_ENABLE_CACHE=true

MODEL_PATH=/mnt/fraud-models
API_MODEL_VERSION=v1.0.0
API_PROMETHEUS_PORT=9090
API_USERNAME=pipeline-user
API_PASSWORD=your_secure_password

# Security
JWT_SECRET_KEY=CHANGE_THIS_JWT_SECRET_KEY_IN_PRODUCTION    # Generate: openssl rand -hex 32
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60

# Service Accounts for JWT Authentication (inter-component communication)
# Each component uses its own service account credentials

# Pipeline Service (data component)
API_USERNAME_PIPELINE=pipeline-user
API_PASSWORD_PIPELINE=CHANGE_THIS_PIPELINE_PASSWORD_IN_PRODUCTION

# Drift Monitor Service
API_USERNAME_DRIFT=drift-monitor-user
API_PASSWORD_DRIFT=CHANGE_THIS_DRIFT_PASSWORD_IN_PRODUCTION

# Training Service
API_USERNAME_TRAINING=training-user
API_PASSWORD_TRAINING=CHANGE_THIS_TRAINING_PASSWORD_IN_PRODUCTION

# Airflow Service
API_USERNAME_AIRFLOW=airflow-user
API_PASSWORD_AIRFLOW=CHANGE_THIS_AIRFLOW_PASSWORD_IN_PRODUCTION

# Legacy (for backward compatibility during migration)
SECRET_KEY=${JWT_SECRET_KEY}
ALGORITHM=${JWT_ALGORITHM}
ACCESS_TOKEN_EXPIRE_MINUTES=${JWT_ACCESS_TOKEN_EXPIRE_MINUTES}
API_KEY_HEADER=X-API-Key
REQUIRE_API_KEY=false
API_KEYS=prod_api_key_1,prod_api_key_2
ADMIN_TOKEN=CHANGE_THIS_ADMIN_TOKEN_IN_PRODUCTION

# ==============================================================================
# DATA MODULE CONFIGURATION
# ==============================================================================
DATA_API_URL=https://fraud-detection-api.azurewebsites.net
DATA_API_TIMEOUT_SECONDS=60
DATA_WEBAPP_URL=
DATA_WEBAPP_TIMEOUT_SECONDS=30
DATA_PROMETHEUS_PORT=9092
DATA_ENABLE_PROFILING=false
DATA_ENABLE_DATA_VALIDATION=true

# JWT Authentication for Data Pipeline
API_USERNAME=${API_USERNAME_PIPELINE}
API_PASSWORD=${API_PASSWORD_PIPELINE}
API_TOKEN=  # Optional: pre-existing token

# Kafka Configuration
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_TOPIC=fraud-detection-transactions
KAFKA_CONSUMER_GROUP=fraud-detection-pipeline
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_BATCH_SIZE=1000
KAFKA_TIMEOUT_MS=60000
KAFKA_MAX_POLL_RECORDS=500

# ==============================================================================
# DRIFT MODULE CONFIGURATION
# ==============================================================================
# API Configuration for Drift Monitoring
API_BASE_URL=${DATA_API_URL}
API_TIMEOUT=30
REFERENCE_WINDOW_DAYS=30

# JWT Authentication for Drift Monitor (uses drift service account)
# Note: Override API_USERNAME and API_PASSWORD in drift container with drift-specific credentials
# These will be set in docker-compose.yml per service

# Drift Thresholds
DATA_DRIFT_THRESHOLD=0.3
TARGET_DRIFT_THRESHOLD=0.5
CONCEPT_DRIFT_THRESHOLD=0.05

# Retraining Configuration
RETRAINING_COOLDOWN_HOURS=48
CONSECUTIVE_DRIFT_DETECTIONS=2

# Alert Configuration
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_RECIPIENTS=ml-team@company.com,ops-team@company.com
ALERT_EMAIL_SMTP_HOST=smtp.gmail.com
ALERT_EMAIL_SMTP_PORT=587
ALERT_EMAIL_USERNAME=alerts@company.com
ALERT_EMAIL_PASSWORD=CHANGE_THIS_EMAIL_APP_PASSWORD_IN_PRODUCTION
ALERT_EMAIL_FROM=fraud-drift-monitor@company.com
ALERT_MAX_PER_HOUR=10
ALERT_DEBOUNCE_MINUTES=5

# Prometheus for Drift
DRIFT_PROMETHEUS_PORT=9091
DRIFT_DATA_DRIFT_THRESHOLD=0.3
DRIFT_TARGET_DRIFT_THRESHOLD=0.5
DRIFT_CONCEPT_DRIFT_THRESHOLD=0.05

DRIFT_BASELINE_RECALL=0.98
DRIFT_BASELINE_PRECISION=0.95
DRIFT_BASELINE_FPR=0.015
DRIFT_BASELINE_FRAUD_RATE=0.002

DRIFT_HOURLY_WINDOW_SIZE=3600
DRIFT_DAILY_WINDOW_SIZE=86400
DRIFT_WEEKLY_WINDOW_SIZE=604800

DRIFT_MIN_SAMPLES_FOR_DRIFT=1000
DRIFT_RETRAINING_COOLDOWN_HOURS=48
DRIFT_CONSECUTIVE_DRIFT_DETECTIONS=3

DRIFT_REPORT_ENABLED=true
DRIFT_REPORT_RETENTION_DAYS=90
DRIFT_REPORT_FORMAT=html

DRIFT_PROMETHEUS_PORT=9091


TRAINING_EVAL_METRICS=precision,recall,f1,auc,accuracy
TRAINING_EVAL_THRESHOLD=0.5

TRAINING_PROMETHEUS_PORT=9093

# ==============================================================================
# MONITORING & LOGGING (Shared)
# ==============================================================================
MONITORING_PROMETHEUS_ENABLED=true
MONITORING_LOG_LEVEL=INFO
MONITORING_LOG_FORMAT=json
MONITORING_ENABLE_AUDIT_LOG=true

# ==============================================================================
# ALERTING (Shared)
# ==============================================================================
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_SMTP_HOST=smtp.office365.com
ALERT_EMAIL_SMTP_PORT=587
ALERT_EMAIL_USERNAME=alerts@frauddetection.com
ALERT_EMAIL_PASSWORD=CHANGE_THIS_EMAIL_PASSWORD
ALERT_EMAIL_FROM=alerts@frauddetection.com
ALERT_EMAIL_RECIPIENTS=ml-team@frauddetection.com,ops-team@frauddetection.com

ALERT_SLACK_ENABLED=true
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
ALERT_SLACK_CHANNEL=#fraud-alerts

ALERT_MAX_ALERTS_PER_HOUR=5
ALERT_DEBOUNCE_MINUTES=30

# ==============================================================================
# KAFKA (Message Queue - Alternative to Azure Event Hub)
# ==============================================================================
KAFKA_BOOTSTRAP_SERVERS=your-kafka-namespace.servicebus.windows.net:9093
KAFKA_TOPIC_TRANSACTIONS=fraud-detection-transactions
KAFKA_CONSUMER_GROUP=fraud-detection-pipeline
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_BATCH_SIZE=1000
KAFKA_TIMEOUT_MS=60000

# ==============================================================================
# DOCKER COMPOSE ENVIRONMENT CONFIGURATION
# ==============================================================================
DOCKER_NETWORK=fraud-detection-network
DOCKER_COMPOSE_PROJECT=fraud-detection-ml

# ==============================================================================
# GRAFANA
# ==============================================================================
GRAFANA_ADMIN_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD     # ⚠️ CHANGE IN PRODUCTION
GRAFANA_USER=admin

# ==============================================================================
# SMTP (Optional - for Airflow email alerts)
# ==============================================================================
SMTP_USER=alerts@frauddetection.com
SMTP_PASSWORD=CHANGE_THIS_SMTP_PASSWORD

# ==============================================================================
# PRODUCTION SPECIFIC
# ==============================================================================
# Docker Hub Registry
DOCKERHUB_USERNAME=yoshua24

# Docker network for cross-service communication
DOCKER_NETWORK=fraud-detection-network

# Alert email for notifications
ALERT_EMAIL=ml-alerts@frauddetection.com

# JWT Secret for API authentication (if used)
JWT_SECRET_KEY=CHANGE_THIS_JWT_SECRET_IN_PRODUCTION

# API Rate Limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_BURST_SIZE=2000

# Model Configuration
MODEL_VERSION=1.0.0
MODEL_ACCURACY_THRESHOLD=0.85

# Drift Detection
DRIFT_DETECTION_ENABLED=true
DRIFT_CHECK_INTERVAL_MINUTES=60

# Data Pipeline
DATA_RETENTION_DAYS=365
BATCH_SIZE=1000

# Monitoring
PROMETHEUS_RETENTION_DAYS=30
GRAFANA_DASHBOARD_REFRESH_INTERVAL=30s

# ==============================================================================
# AZURE WEB APP SECRETS (for GitHub Actions)
# ==============================================================================
# These correspond to the secrets used in .github/workflows/ci-cd.yml
#
# Required GitHub Secrets to set up:
# AZURE_CREDENTIALS - Service Principal credentials (JSON format)
# AZURE_CLIENT_ID - Service Principal Client ID
# AZURE_CLIENT_SECRET - Service Principal Client Secret
# AZURE_RESOURCE_GROUP - Resource Group name
# AZURE_LOCATION - Azure region (e.g., eastus)
# DB_HOST_STAGING - Staging database host
# DB_USER_STAGING - Staging database user
# DB_PASSWORD_STAGING - Staging database password
# REDIS_HOST_STAGING - Staging Redis host
# MLFLOW_TRACKING_URI_STAGING - Staging MLflow URI
# DB_HOST_PRODUCTION - Production database host
# DB_USER_PRODUCTION - Production database user
# DB_PASSWORD_PRODUCTION - Production database password
# REDIS_HOST_PRODUCTION - Production Redis host
# MLFLOW_TRACKING_URI_PRODUCTION - Production MLflow URI
# AZURE_STORAGE_CONNECTION_STRING - Azure Storage connection string
